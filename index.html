<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="UTF-8">
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #fafafa;
        max-width: 500px;
        margin: 40px auto;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0,0,0,0.1);
        position: relative;
      }
      h2 { text-align: center; color: #333; }
      label { display: block; margin-top: 15px; }
      input, select, button {
        width: 100%;
        padding: 10px;
        margin-top: 5px;
        border-radius: 5px;
        border: 1px solid #ccc;
        font-size: 16px;
      }
      .acompanhantes { margin-top: 15px; }
      button {
        background-color: #25d366;
        color: white;
        border: none;
        cursor: pointer;
        margin-top: 20px;
      }
      button:hover { background-color: #1ebe5b; }

      /* Tela de carregamento */
      .overlay {
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.4);
        z-index: 999;
        justify-content: center;
        align-items: center;
      }

      .spinner {
        border: 6px solid #f3f3f3;
        border-top: 6px solid #25d366;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body>
    <h2>Confirma√ß√£o de Presen√ßa</h2>

    <label for="nome">Seu nome completo:</label>
    <input type="text" id="nome" placeholder="Ex: Jo√£o da Silva" required>

    <label for="qtd">Quantos acompanhantes?</label>
    <select id="qtd" onchange="gerarCampos()">
      <option value="0">0</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
      <option value="9">9</option>
      <option value="10">10</option>
    </select>

    <div id="camposAcompanhantes" class="acompanhantes"></div>

    <button onclick="confirmarPresenca()">Confirmar Presen√ßa</button>

    <!-- Tela de carregamento -->
    <div class="overlay" id="overlay">
      <div class="spinner"></div>
    </div>

    <script>
      function gerarCampos() {
        const qtd = document.getElementById('qtd').value;
        const container = document.getElementById('camposAcompanhantes');
        container.innerHTML = '';
        for (let i = 1; i <= qtd; i++) {
          const input = document.createElement('input');
          input.placeholder = `Nome do acompanhante ${i}`;
          input.id = `acomp${i}`;
          input.required = true;
          container.appendChild(input);
        }
      }

      function confirmarPresenca() {
        const nome = document.getElementById('nome').value.trim();
        if (!nome) {
          alert("Por favor, preencha seu nome.");
          return;
        }

        const qtd = parseInt(document.getElementById('qtd').value);
        let acompanhantes = [];
        let camposVazios = false;

        for (let i = 1; i <= qtd; i++) {
          const campo = document.getElementById(`acomp${i}`);
          const nomeAcomp = campo ? campo.value.trim() : '';
          if (!nomeAcomp) {
            camposVazios = true;
          } else {
            acompanhantes.push(nomeAcomp);
          }
        }

        if (qtd > 0 && camposVazios) {
          alert("Voc√™ selecionou acompanhantes. Por favor, preencha todos os nomes.");
          return;
        }

        // Mostra o carregando
        document.getElementById("overlay").style.display = "flex";

        fetch("https://confirmacao.danielfelipe-engcivil.workers.dev/", {
          method: "POST",
          body: JSON.stringify({
            nomePrincipal: nome,
            nomesAcompanhantes: acompanhantes,
            quantidade: qtd
          }),
          headers: { "Content-Type": "application/json" }
        }).then(response => response.json())
          .then(data => {
            document.getElementById("overlay").style.display = "none"; // esconde o loading
            if (data.status === "success") {
              let mensagem = `‚úÖ *Confirma√ß√£o de Presen√ßa*%0A%0Aüë§ *Convidado:* ${nome}`;
              if (acompanhantes.length > 0) {
                mensagem += `%0Aüë• *Acompanhantes:*%0A`;
                acompanhantes.forEach(acomp => {
                  mensagem += `‚Ä¢ ${acomp}%0A`;
                });
              }
              mensagem += `%0Aüíí Mal posso esperar por esse momento especial com voc√™s! ‚ú®`;

              const numero = "556392255000";
              const url = `https://wa.me/${numero}?text=${mensagem}`;
              window.open(url, '_blank');
            } else {
              alert("Houve um erro ao confirmar presen√ßa. Tente novamente.");
              console.error(data.message);
            }
          }).catch((error) => {
            document.getElementById("overlay").style.display = "none";
            alert("Erro ao enviar confirma√ß√£o. Tente novamente.");
            console.error(error);
          });
      }
    </script>
  </body>
</html>
